C51 COMPILER V9.51   RTC_HANDLER                                                           05/10/2014 16:55:35 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE RTC_HANDLER
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\RTC_Handler.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\RTC_Handler.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051\DP8051_Keil_951\Debug\RTC_Handler.lst) CD DB NOIP OT(0,SIZE) DF
                    -(DEBUG) INCDIR(.,.\Generated_Source\PSoC3) OJ(.\DP8051\DP8051_Keil_951\Debug\RTC_Handler.obj)

line level    source

   1          /* ========================================
   2           *
   3           * Copyright YOUR COMPANY, THE YEAR
   4           * All Rights Reserved
   5           * UNPUBLISHED, LICENSED SOFTWARE.
   6           *
   7           * CONFIDENTIAL AND PROPRIETARY INFORMATION
   8           * WHICH IS THE PROPERTY OF your company.
   9           *
  10           * ========================================
  11          */
  12          
  13          #include "RTC_Handler.h"
  14          
  15          uint8 RTC_int_mask = 0x0u;
  16          
  17          void rtc_setup()
  18          {
  19   1      
  20   1          // sample_interval and sample_unit are global, defined in main.c    
  21   1          sample_unit = get_variable(EE_SAMPLE_UNIT);
  22   1          sample_interval = get_variable(EE_SAMPLE_INTERVAL);
  23   1          
  24   1          RTC_int_mask = MINUTE_MASK | SECOND_MASK;
  25   1          
  26   1          switch (sample_unit)
  27   1          {
  28   2              case SAMPLE_HOUR: /* Hours */
  29   2                  RTC_int_mask = RTC_int_mask | HOUR_MASK;
  30   2                  break;
  31   2              case SAMPLE_DAY: /* Days */
  32   2                  RTC_int_mask = RTC_int_mask | DAY_MASK;
  33   2                  break;
  34   2          }
  35   1          
  36   1          RTC_WriteIntervalMask(RTC_int_mask);
  37   1          RTC_EnableInt();
  38   1          
  39   1          return;
  40   1       }
  41          
  42          uint8 sync_RTC(RTC_TIME_DATE* new_time){
  43   1          
  44   1          RTC_DisableInt();
  45   1          RTC_WriteTime(new_time);
  46   1          RTC_EnableInt();
  47   1          
  48   1          return SUCCESS;
  49   1      }
  50          /* [] END OF FILE */
C51 COMPILER V9.51   RTC_HANDLER                                                           05/10/2014 16:55:35 PAGE 2   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION rtc_setup (BEGIN)
                                           ; SOURCE LINE # 17
                                           ; SOURCE LINE # 18
                                           ; SOURCE LINE # 21
0000 7F01              MOV     R7,#01H
0002 7E00              MOV     R6,#00H
0004 120000      E     LCALL   _get_variable
0007 900000      E     MOV     DPTR,#sample_unit
000A EF                MOV     A,R7
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 22
000C 7F02              MOV     R7,#02H
000E 7E00              MOV     R6,#00H
0010 120000      E     LCALL   _get_variable
0013 900000      E     MOV     DPTR,#sample_interval
0016 EF                MOV     A,R7
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 24
0018 900000      R     MOV     DPTR,#RTC_int_mask
001B 7403              MOV     A,#03H
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 26
001E 900000      E     MOV     DPTR,#sample_unit
0021 E0                MOVX    A,@DPTR
0022 FF                MOV     R7,A
0023 EF                MOV     A,R7
0024 120000      E     LCALL   ?C?CCASE
0027 0000        R     DW      ?C0002
0029 02                DB      02H
002A 0000        R     DW      ?C0003
002C 03                DB      03H
002D 0000              DW      00H
002F 0000        R     DW      ?C0001
                                           ; SOURCE LINE # 27
                                           ; SOURCE LINE # 28
0031         ?C0002:
                                           ; SOURCE LINE # 29
0031 900000      R     MOV     DPTR,#RTC_int_mask
0034 E0                MOVX    A,@DPTR
0035 FF                MOV     R7,A
0036 EF                MOV     A,R7
0037 4404              ORL     A,#04H
0039 FF                MOV     R7,A
003A 900000      R     MOV     DPTR,#RTC_int_mask
003D EF                MOV     A,R7
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 30
003F 800E              SJMP    ?C0001
                                           ; SOURCE LINE # 31
0041         ?C0003:
                                           ; SOURCE LINE # 32
0041 900000      R     MOV     DPTR,#RTC_int_mask
0044 E0                MOVX    A,@DPTR
0045 FF                MOV     R7,A
0046 EF                MOV     A,R7
0047 4408              ORL     A,#08H
0049 FF                MOV     R7,A
004A 900000      R     MOV     DPTR,#RTC_int_mask
004D EF                MOV     A,R7
C51 COMPILER V9.51   RTC_HANDLER                                                           05/10/2014 16:55:35 PAGE 3   

004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
004F         ?C0001:
                                           ; SOURCE LINE # 36
004F 900000      R     MOV     DPTR,#RTC_int_mask
0052 E0                MOVX    A,@DPTR
0053 FF                MOV     R7,A
0054 120000      E     LCALL   _RTC_WriteIntervalMask
                                           ; SOURCE LINE # 37
0057 120000      E     LCALL   RTC_EnableInt
                                           ; SOURCE LINE # 40
005A         ?C0004:
005A 22                RET     
             ; FUNCTION rtc_setup (END)

             ; FUNCTION _sync_RTC (BEGIN)
                                           ; SOURCE LINE # 42
0000 900000      R     MOV     DPTR,#new_time
0003 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 44
0006 120000      E     LCALL   RTC_DisableInt
                                           ; SOURCE LINE # 45
0009 900000      R     MOV     DPTR,#new_time
000C 120000      E     LCALL   ?C?PLDXDATA
000F 120000      E     LCALL   _RTC_WriteTime
                                           ; SOURCE LINE # 46
0012 120000      E     LCALL   RTC_EnableInt
                                           ; SOURCE LINE # 48
0015 7F02              MOV     R7,#02H
                                           ; SOURCE LINE # 49
0017         ?C0005:
0017 22                RET     
             ; FUNCTION _sync_RTC (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    115    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
