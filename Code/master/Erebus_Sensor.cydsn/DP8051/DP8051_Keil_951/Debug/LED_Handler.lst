C51 COMPILER V9.51   LED_HANDLER                                                           05/07/2014 01:13:20 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE LED_HANDLER
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\LED_Handler.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\LED_Handler.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051\DP8051_Keil_951\Debug\LED_Handler.lst) CD DB NOIP OT(0,SIZE) DF
                    -(DEBUG) INCDIR(.,.\Generated_Source\PSoC3) OJ(.\DP8051\DP8051_Keil_951\Debug\LED_Handler.obj)

line level    source

   1          /* ========================================
   2           *
   3           * Copyright YOUR COMPANY, THE YEAR
   4           * All Rights Reserved
   5           * UNPUBLISHED, LICENSED SOFTWARE.
   6           *
   7           * CONFIDENTIAL AND PROPRIETARY INFORMATION
   8           * WHICH IS THE PROPERTY OF your company.
   9           *
  10           * ========================================
  11          */
  12          
  13          #include "LED_Handler.h"
  14          
  15          static uint8 state;
  16          
  17          void LED_on(uint8 target){
  18   1          
  19   1          switch (target){   
  20   2          
  21   2              case USB:
  22   2                  /* Green */
  23   2                  LED0_CTRL_Write(GREEN);
  24   2                  LED1_CTRL_Write(GREEN);
  25   2                  break;
  26   2              
  27   2              case ERROR:
  28   2                  /* Red */
  29   2                  LED0_CTRL_Write(RED);
  30   2                  LED1_CTRL_Write(RED);
  31   2                  break;
  32   2                  
  33   2              case LOWBATT:
  34   2                  /* Yellow */
  35   2                  LED0_CTRL_Write(GREEN);
  36   2                  LED1_CTRL_Write(RED);
  37   2                  break;
  38   2              
  39   2              case SAMPLE:
  40   2                  /* BLUE */
  41   2                  LED0_CTRL_Write(BLUE);
  42   2                  LED1_CTRL_Write(GREEN);
  43   2                  break;  
  44   2                  
  45   2              case MEM:
  46   2                  /* Cyan */
  47   2                  LED0_CTRL_Write(BLUE);
  48   2                  LED1_CTRL_Write(BLUE);  
  49   2                  break;
  50   2          }
  51   1          return;
  52   1      }
  53          
C51 COMPILER V9.51   LED_HANDLER                                                           05/07/2014 01:13:20 PAGE 2   

  54          void LED_off(uint8 target){
  55   1          
  56   1          switch (target){
  57   2              
  58   2              case USB:
  59   2                  /* Green */
  60   2                  LED0_CTRL_Write(OFF);
  61   2                  LED1_CTRL_Write(OFF);
  62   2                  break;
  63   2         
  64   2              case SAMPLE:
  65   2                      
  66   2                  if (low_power_flag){
  67   3                      LED0_CTRL_Write(GREEN);
  68   3                      LED1_CTRL_Write(RED);
  69   3                  }
  70   2                  
  71   2                  else{
  72   3                      LED0_CTRL_Write(OFF);
  73   3                      LED1_CTRL_Write(OFF);
  74   3                  }      
  75   2                  break;  
  76   2                  
  77   2              case MEM:         
  78   2                  if (Vbus_Read()){
  79   3                      LED0_CTRL_Write(GREEN);
  80   3                      LED1_CTRL_Write(GREEN);
  81   3                  }
  82   2                  else{
  83   3                      LED0_CTRL_Write(OFF);
  84   3                      LED1_CTRL_Write(OFF);
  85   3                  } 
  86   2                  break;
  87   2          }
  88   1          
  89   1          return;
  90   1      }
  91          
  92          void blink_green(){
  93   1          
  94   1          uint8 i;
  95   1          
  96   1          /* This loop has an odd structure so that there is no delay after it's turned off
  97   1             the last time */
  98   1          
  99   1          LED_on(USB); // pretend it's USB since USB is solid green
 100   1          for(i=4;i>0;--i){
 101   2      
 102   2              CyDelay(LED_DELAY);
 103   2              LED_off(USB);
 104   2              CyDelay(LED_DELAY);
 105   2              LED_on(USB);
 106   2      
 107   2          }
 108   1          CyDelay(LED_DELAY);
 109   1          LED_off(USB);
 110   1          
 111   1          return;
 112   1      }
 113          
 114          void blink_red(){
 115   1          
C51 COMPILER V9.51   LED_HANDLER                                                           05/07/2014 01:13:20 PAGE 3   

 116   1          uint8 i;
 117   1          
 118   1          /* This loop has an odd structure so that there is no delay after it's turned off
 119   1             the last time */
 120   1          
 121   1          LED_on(ERROR); // pretend it's ERROR since ERROR is solid red
 122   1          for(i=4;i>0;--i){
 123   2      
 124   2              CyDelay(LED_DELAY);
 125   2              LED_off(USB); // leave off as USB - ERROR has no off
 126   2              CyDelay(LED_DELAY);
 127   2              LED_on(ERROR);
 128   2      
 129   2          }
 130   1          CyDelay(LED_DELAY);
 131   1          LED_off(USB);
 132   1          
 133   1          return;
 134   1      }
 135          
 136          /* [] END OF FILE */
C51 COMPILER V9.51   LED_HANDLER                                                           05/07/2014 01:13:20 PAGE 4   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION _LED_on (BEGIN)
                                           ; SOURCE LINE # 17
0000 900000      R     MOV     DPTR,#target
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 19
0005 900000      R     MOV     DPTR,#target
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 120000      E     LCALL   ?C?CCASE
000E 0000        R     DW      ?C0002
0010 01                DB      01H
0011 0000        R     DW      ?C0006
0013 02                DB      02H
0014 0000        R     DW      ?C0004
0016 03                DB      03H
0017 0000        R     DW      ?C0003
0019 04                DB      04H
001A 0000        R     DW      ?C0005
001C 05                DB      05H
001D 0000              DW      00H
001F 0000        R     DW      ?C0007
                                           ; SOURCE LINE # 21
0021         ?C0002:
                                           ; SOURCE LINE # 23
0021 7F03              MOV     R7,#03H
0023 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 24
0026 7F03              MOV     R7,#03H
0028 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 25
002B 22                RET     
                                           ; SOURCE LINE # 27
002C         ?C0003:
                                           ; SOURCE LINE # 29
002C 7F01              MOV     R7,#01H
002E 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 30
0031 7F01              MOV     R7,#01H
0033 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 31
0036 22                RET     
                                           ; SOURCE LINE # 33
0037         ?C0004:
                                           ; SOURCE LINE # 35
0037 7F03              MOV     R7,#03H
0039 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 36
003C 7F01              MOV     R7,#01H
003E 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 37
0041 22                RET     
                                           ; SOURCE LINE # 39
0042         ?C0005:
                                           ; SOURCE LINE # 41
0042 7F02              MOV     R7,#02H
0044 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 42
C51 COMPILER V9.51   LED_HANDLER                                                           05/07/2014 01:13:20 PAGE 5   

0047 7F03              MOV     R7,#03H
0049 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 43
004C 22                RET     
                                           ; SOURCE LINE # 45
004D         ?C0006:
                                           ; SOURCE LINE # 47
004D 7F02              MOV     R7,#02H
004F 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 48
0052 7F02              MOV     R7,#02H
0054 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 49
                                           ; SOURCE LINE # 50
0057         ?C0001:
                                           ; SOURCE LINE # 52
0057         ?C0007:
0057 22                RET     
             ; FUNCTION _LED_on (END)

             ; FUNCTION _LED_off (BEGIN)
                                           ; SOURCE LINE # 54
0000 900000      R     MOV     DPTR,#target
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 56
0005 900000      R     MOV     DPTR,#target
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 120000      E     LCALL   ?C?CCASE
000E 0000        R     DW      ?C0009
0010 01                DB      01H
0011 0000        R     DW      ?C0013
0013 02                DB      02H
0014 0000        R     DW      ?C0010
0016 05                DB      05H
0017 0000              DW      00H
0019 0000        R     DW      ?C0016
                                           ; SOURCE LINE # 58
001B         ?C0009:
                                           ; SOURCE LINE # 60
001B 7F00              MOV     R7,#00H
001D 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 61
0020 7F00              MOV     R7,#00H
0022 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 62
0025 22                RET     
                                           ; SOURCE LINE # 64
0026         ?C0010:
                                           ; SOURCE LINE # 66
0026 900000      E     MOV     DPTR,#low_power_flag
0029 E0                MOVX    A,@DPTR
002A FF                MOV     R7,A
002B EF                MOV     A,R7
002C 600B              JZ      ?C0011
                                           ; SOURCE LINE # 67
002E 7F03              MOV     R7,#03H
0030 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 68
0033 7F01              MOV     R7,#01H
C51 COMPILER V9.51   LED_HANDLER                                                           05/07/2014 01:13:20 PAGE 6   

0035 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 69
0038 22                RET     
0039         ?C0011:
                                           ; SOURCE LINE # 71
                                           ; SOURCE LINE # 72
0039 7F00              MOV     R7,#00H
003B 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 73
003E 7F00              MOV     R7,#00H
0040 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 74
0043         ?C0012:
                                           ; SOURCE LINE # 75
0043 22                RET     
                                           ; SOURCE LINE # 77
0044         ?C0013:
                                           ; SOURCE LINE # 78
0044 120000      E     LCALL   Vbus_Read
0047 EF                MOV     A,R7
0048 600B              JZ      ?C0014
                                           ; SOURCE LINE # 79
004A 7F03              MOV     R7,#03H
004C 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 80
004F 7F03              MOV     R7,#03H
0051 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 81
0054 22                RET     
0055         ?C0014:
                                           ; SOURCE LINE # 82
                                           ; SOURCE LINE # 83
0055 7F00              MOV     R7,#00H
0057 120000      E     LCALL   _LED0_CTRL_Write
                                           ; SOURCE LINE # 84
005A 7F00              MOV     R7,#00H
005C 120000      E     LCALL   _LED1_CTRL_Write
                                           ; SOURCE LINE # 85
005F         ?C0015:
                                           ; SOURCE LINE # 86
                                           ; SOURCE LINE # 87
005F         ?C0008:
                                           ; SOURCE LINE # 90
005F         ?C0016:
005F 22                RET     
             ; FUNCTION _LED_off (END)

             ; FUNCTION blink_green (BEGIN)
                                           ; SOURCE LINE # 92
                                           ; SOURCE LINE # 99
0000 7F01              MOV     R7,#01H
0002 120000      R     LCALL   _LED_on
                                           ; SOURCE LINE # 100
0005 900000      R     MOV     DPTR,#i
0008 7404              MOV     A,#04H
000A F0                MOVX    @DPTR,A
000B         ?C0017:
000B 900000      R     MOV     DPTR,#i
000E E0                MOVX    A,@DPTR
000F FF                MOV     R7,A
0010 EF                MOV     A,R7
0011 D3                SETB    C
C51 COMPILER V9.51   LED_HANDLER                                                           05/07/2014 01:13:20 PAGE 7   

0012 9400              SUBB    A,#00H
0014 4028              JC      ?C0018
                                           ; SOURCE LINE # 102
0016 7F64              MOV     R7,#064H
0018 7E00              MOV     R6,#00H
001A 7D00              MOV     R5,#00H
001C 7C00              MOV     R4,#00H
001E 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 103
0021 7F01              MOV     R7,#01H
0023 120000      R     LCALL   _LED_off
                                           ; SOURCE LINE # 104
0026 7F64              MOV     R7,#064H
0028 7E00              MOV     R6,#00H
002A 7D00              MOV     R5,#00H
002C 7C00              MOV     R4,#00H
002E 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 105
0031 7F01              MOV     R7,#01H
0033 120000      R     LCALL   _LED_on
                                           ; SOURCE LINE # 107
0036         ?C0019:
0036 900000      R     MOV     DPTR,#i
0039 E0                MOVX    A,@DPTR
003A 14                DEC     A
003B F0                MOVX    @DPTR,A
003C 80CD              SJMP    ?C0017
003E         ?C0018:
                                           ; SOURCE LINE # 108
003E 7F64              MOV     R7,#064H
0040 7E00              MOV     R6,#00H
0042 7D00              MOV     R5,#00H
0044 7C00              MOV     R4,#00H
0046 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 109
0049 7F01              MOV     R7,#01H
004B 120000      R     LCALL   _LED_off
                                           ; SOURCE LINE # 112
004E         ?C0020:
004E 22                RET     
             ; FUNCTION blink_green (END)

             ; FUNCTION blink_red (BEGIN)
                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 121
0000 7F04              MOV     R7,#04H
0002 120000      R     LCALL   _LED_on
                                           ; SOURCE LINE # 122
0005 900000      R     MOV     DPTR,#i
0008 7404              MOV     A,#04H
000A F0                MOVX    @DPTR,A
000B         ?C0021:
000B 900000      R     MOV     DPTR,#i
000E E0                MOVX    A,@DPTR
000F FF                MOV     R7,A
0010 EF                MOV     A,R7
0011 D3                SETB    C
0012 9400              SUBB    A,#00H
0014 4028              JC      ?C0022
                                           ; SOURCE LINE # 124
0016 7F64              MOV     R7,#064H
0018 7E00              MOV     R6,#00H
C51 COMPILER V9.51   LED_HANDLER                                                           05/07/2014 01:13:20 PAGE 8   

001A 7D00              MOV     R5,#00H
001C 7C00              MOV     R4,#00H
001E 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 125
0021 7F01              MOV     R7,#01H
0023 120000      R     LCALL   _LED_off
                                           ; SOURCE LINE # 126
0026 7F64              MOV     R7,#064H
0028 7E00              MOV     R6,#00H
002A 7D00              MOV     R5,#00H
002C 7C00              MOV     R4,#00H
002E 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 127
0031 7F04              MOV     R7,#04H
0033 120000      R     LCALL   _LED_on
                                           ; SOURCE LINE # 129
0036         ?C0023:
0036 900000      R     MOV     DPTR,#i
0039 E0                MOVX    A,@DPTR
003A 14                DEC     A
003B F0                MOVX    @DPTR,A
003C 80CD              SJMP    ?C0021
003E         ?C0022:
                                           ; SOURCE LINE # 130
003E 7F64              MOV     R7,#064H
0040 7E00              MOV     R6,#00H
0042 7D00              MOV     R5,#00H
0044 7C00              MOV     R4,#00H
0046 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 131
0049 7F01              MOV     R7,#01H
004B 120000      R     LCALL   _LED_off
                                           ; SOURCE LINE # 134
004E         ?C0024:
004E 22                RET     
             ; FUNCTION blink_red (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    342    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      5    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
