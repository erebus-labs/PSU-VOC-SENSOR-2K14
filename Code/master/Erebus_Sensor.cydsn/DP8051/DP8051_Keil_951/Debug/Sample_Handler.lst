C51 COMPILER V9.51   SAMPLE_HANDLER                                                        05/10/2014 16:55:34 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE SAMPLE_HANDLER
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\Sample_Handler.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\Sample_Handler.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051\DP8051_Keil_951\Debug\Sample_Handler.lst) CD DB NOIP OT(0,SI
                    -ZE) DF(DEBUG) INCDIR(.,.\Generated_Source\PSoC3) OJ(.\DP8051\DP8051_Keil_951\Debug\Sample_Handler.obj)

line level    source

   1          /* ========================================
   2           *
   3           * Copyright YOUR COMPANY, THE YEAR
   4           * All Rights Reserved
   5           * UNPUBLISHED, LICENSED SOFTWARE.
   6           *
   7           * CONFIDENTIAL AND PROPRIETARY INFORMATION
   8           * WHICH IS THE PROPERTY OF your company.
   9           *
  10           * ========================================
  11          */
  12          #include "Sample_Handler.h"
  13          
  14          
  15          void take_sample()
  16          {
  17   1          uint16 SampledData = 0;
  18   1          ADC_Wakeup();
  19   1          
  20   1          /* ADC */
  21   1          SampledData = ADC_Read16(); /* Function Starts, Converts, Stops, and Returns from ADC */
  22   1          
  23   1          /* EEP */
  24   1          Em_EEPROM_Write((uint8*) (&SampledData),TailPtr,2u);
  25   1          
  26   1          TailPtr = TailPtr + 2;
  27   1          ADC_Sleep();
  28   1          return;    
  29   1      }
  30          
  31          void check_battery(){
  32   1          uint16 SampledData = 0;
  33   1          ADC_Wakeup();
  34   1          ADC_MUX_Select(BATT_PIN);
  35   1          
  36   1          SampledData = ADC_Read16(); /* Function Starts, Converts, Stops, and Returns from ADC */
  37   1          
  38   1          if (SampledData <= BATT_THRESHOLD){
  39   2              low_power_flag = 1;
  40   2          }
  41   1          else{
  42   2              low_power_flag = 0;
  43   2          }
  44   1          
  45   1          ADC_Sleep();
  46   1          ADC_MUX_FastSelect(SAMPLE_PIN);
  47   1          
  48   1          return;
  49   1      }
  50              
  51          /* [] END OF FILE */
C51 COMPILER V9.51   SAMPLE_HANDLER                                                        05/10/2014 16:55:34 PAGE 2   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION take_sample (BEGIN)
                                           ; SOURCE LINE # 15
                                           ; SOURCE LINE # 16
                                           ; SOURCE LINE # 17
0000 900000      R     MOV     DPTR,#SampledData
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 E4                CLR     A
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 18
0008 120000      E     LCALL   ADC_Wakeup
                                           ; SOURCE LINE # 21
000B 120000      E     LCALL   ADC_Read16
000E 900000      R     MOV     DPTR,#SampledData
0011 EE                MOV     A,R6
0012 F0                MOVX    @DPTR,A
0013 A3                INC     DPTR
0014 EF                MOV     A,R7
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 24
0016 7B01              MOV     R3,#01H
0018 7A00        R     MOV     R2,#HIGH SampledData
001A 7900        R     MOV     R1,#LOW SampledData
001C C003              PUSH    AR3
001E C002              PUSH    AR2
0020 C001              PUSH    AR1
0022 900000      E     MOV     DPTR,#TailPtr
0025 120000      E     LCALL   ?C?PLDXDATA
0028 900000      E     MOV     DPTR,#?_Em_EEPROM_Write?BYTE+03H
002B 120000      E     LCALL   ?C?PSTXDATA
002E 900000      E     MOV     DPTR,#?_Em_EEPROM_Write?BYTE+06H
0031 E4                CLR     A
0032 F0                MOVX    @DPTR,A
0033 A3                INC     DPTR
0034 7402              MOV     A,#02H
0036 F0                MOVX    @DPTR,A
0037 D001              POP     AR1
0039 D002              POP     AR2
003B D003              POP     AR3
003D 120000      E     LCALL   _Em_EEPROM_Write
                                           ; SOURCE LINE # 26
0040 900000      E     MOV     DPTR,#TailPtr+01H
0043 E4                CLR     A
0044 75F002            MOV     B,#02H
0047 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 27
004A 120000      E     LCALL   ADC_Sleep
                                           ; SOURCE LINE # 29
004D         ?C0001:
004D 22                RET     
             ; FUNCTION take_sample (END)

             ; FUNCTION check_battery (BEGIN)
                                           ; SOURCE LINE # 31
                                           ; SOURCE LINE # 32
0000 900000      R     MOV     DPTR,#SampledData
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   SAMPLE_HANDLER                                                        05/10/2014 16:55:34 PAGE 3   

0005 A3                INC     DPTR
0006 E4                CLR     A
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 33
0008 120000      E     LCALL   ADC_Wakeup
                                           ; SOURCE LINE # 34
000B 7F01              MOV     R7,#01H
000D 120000      E     LCALL   _ADC_MUX_FastSelect
                                           ; SOURCE LINE # 36
0010 120000      E     LCALL   ADC_Read16
0013 900000      R     MOV     DPTR,#SampledData
0016 EE                MOV     A,R6
0017 F0                MOVX    @DPTR,A
0018 A3                INC     DPTR
0019 EF                MOV     A,R7
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 38
001B 900000      R     MOV     DPTR,#SampledData
001E E0                MOVX    A,@DPTR
001F FE                MOV     R6,A
0020 A3                INC     DPTR
0021 E0                MOVX    A,@DPTR
0022 FF                MOV     R7,A
0023 D3                SETB    C
0024 EF                MOV     A,R7
0025 94AC              SUBB    A,#0ACH
0027 EE                MOV     A,R6
0028 940D              SUBB    A,#0DH
002A 5008              JNC     ?C0002
                                           ; SOURCE LINE # 39
002C 900000      E     MOV     DPTR,#low_power_flag
002F 7401              MOV     A,#01H
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 40
0032 8005              SJMP    ?C0003
0034         ?C0002:
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
0034 900000      E     MOV     DPTR,#low_power_flag
0037 E4                CLR     A
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 43
0039         ?C0003:
                                           ; SOURCE LINE # 45
0039 120000      E     LCALL   ADC_Sleep
                                           ; SOURCE LINE # 46
003C 7F00              MOV     R7,#00H
003E 120000      E     LCALL   _ADC_MUX_FastSelect
                                           ; SOURCE LINE # 49
0041         ?C0004:
0041 22                RET     
             ; FUNCTION check_battery (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    144    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.51   SAMPLE_HANDLER                                                        05/10/2014 16:55:34 PAGE 4   

   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
