C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE USB_ACCESS
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\USB_Access.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\USB_Access.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051\DP8051_Keil_951\Debug\USB_Access.lst) CD DB NOIP OT(0,SIZE) DF(D
                    -EBUG) INCDIR(.,.\Generated_Source\PSoC3) OJ(.\DP8051\DP8051_Keil_951\Debug\USB_Access.obj)

line level    source

   1          /* ========================================
   2           *
   3           * Copyright YOUR COMPANY, THE YEAR
   4           * All Rights Reserved
   5           * UNPUBLISHED, LICENSED SOFTWARE.
   6           *
   7           * CONFIDENTIAL AND PROPRIETARY INFORMATION
   8           * WHICH IS THE PROPERTY OF your company.
   9           *
  10           * ========================================
  11          */
  12          
  13          #include "USB_Access.h"
  14          
  15          /* This file provides function definitions for USB interactions */
  16          
  17          void USB_ISR(){
  18   1          
  19   1          // Power has just been applied to the Vbus pin, so we enter USB communication mode
  20   1      
  21   1          uint8 result = 0;
  22   1          uint8 command = 0;
  23   1          USB_LED_on();
  24   1                 
  25   1          /* Start USBFS Operation with 5V operation */
  26   1          USBUART_Start(0u, USBUART_5V_OPERATION);
  27   1          
  28   1          /* Wait for Device to enumerate */
  29   1          while(!USBUART_GetConfiguration() && Vbus_Read());
  30   1      
  31   1          /* Enumeration is done, enable OUT endpoint for receive data from Host */
  32   1          USBUART_CDC_Init();
  33   1            
  34   1          while(Vbus_Read())
  35   1          {  
  36   2              if(USBUART_DataIsReady() != 0u){   /* Check for input data from PC */
  37   3                  result = retrieve(&command, COMMAND_LENGTH);
  38   3                  
  39   3                  // Discard null bytes
  40   3                  if (command == NULL_BYTE){
  41   4                      continue;
  42   4                  }
  43   3              
  44   3                  if (result == SUCCESS){
  45   4                      
  46   4                      switch (command){
  47   5                      
  48   5                          case IDENTIFY:
  49   5                              send_reply(IDENTIFIER);
  50   5                              break;
  51   5                          
  52   5                          case DUMP_DATA:
  53   5                              dump_data();
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 2   

  54   5                              confirm_dump();
  55   5                              break;
  56   5                              
  57   5                          case GET_SETTINGS:
  58   5                              send_settings();
  59   5                              break;
  60   5                              
  61   5                          case CHANGE_SETTING:
  62   5                              send_reply(SUCCESS);
  63   5                              if (apply_settings() == SUCCESS){
  64   6                                  send_reply(SUCCESS);
  65   6                              }
  66   5                              else{
  67   6                                  send_reply(FAIL);
  68   6                              }                  
  69   5                              break;
  70   5                              
  71   5                          case UPDATE_RTC:
  72   5                              send_reply(SUCCESS);
  73   5                              if (update_RTC() == SUCCESS){
  74   6                                  send_reply(SUCCESS);
  75   6                              }
  76   5                              else{
  77   6                                  send_reply(FAIL);
  78   6                              }
  79   5                              break;
  80   5                           
  81   5                          case HARD_RESET:
  82   5                              hard_reset();
  83   5                              send_reply(SUCCESS);
  84   5                              break;
  85   5                              
  86   5                          default:
  87   5                              send_reply(FAIL);
  88   5                              break;
  89   5                      }
  90   4                  }   
  91   3                  else{
  92   4                      send_reply(FAIL);
  93   4                  }
  94   3              }
  95   2          }
  96   1          
  97   1          USBUART_Stop();
  98   1          USB_LED_off();
  99   1          
 100   1          return;
 101   1      }
 102          
 103          uint8 retrieve(uint8* buffer, uint8 num_bytes){
 104   1          uint16 count = 0;
 105   1          uint8 attempts = 0;
 106   1          uint8 result = SUCCESS;
 107   1          
 108   1          count = USBUART_GetCount(); 
 109   1          
 110   1          // If data in buffer is the right amount for a command,
 111   1          // retrieve it
 112   1          if(count == num_bytes){
 113   2              USBUART_GetData(buffer, num_bytes);
 114   2          }
 115   1          // Otherwise, flush the USB buffer and report fail
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 3   

 116   1          else{
 117   2              USBUART_GetChar();
 118   2              result = FAIL;
 119   2          }
 120   1          
 121   1          return result;
 122   1      }
 123          
 124          uint8 apply_settings(){
 125   1          uint8 result = FAIL;
 126   1          uint8 settings_buffer[NUM_SETTINGS] = {0};
 127   1          settings_group new_settings;
 128   1          
 129   1          while (!USBUART_DataIsReady() && Vbus_Read());
 130   1          
 131   1          if (Vbus_Read()){
 132   2              if (retrieve(settings_buffer, NUM_SETTINGS) == SUCCESS){
 133   3                  new_settings.sensor = settings_buffer[0];
 134   3                  new_settings.sample_unit = settings_buffer[1];
 135   3                  new_settings.sample_interval = settings_buffer[2];
 136   3                  
 137   3                  result = update_settings(new_settings);   
 138   3              }
 139   2          } 
 140   1          
 141   1          return result;
 142   1      }
 143          
 144          void send_settings(){
 145   1          
 146   1          uint8 settings[NUM_SETTINGS];
 147   1          
 148   1          settings[0] = get_variable(EE_SENSOR);
 149   1          settings[1] = get_variable(EE_SAMPLE_UNIT);
 150   1          settings[2] = get_variable(EE_SAMPLE_INTERVAL);
 151   1          
 152   1          while(!USBUART_CDCIsReady() && Vbus_Read());
 153   1          
 154   1          if(Vbus_Read()){
 155   2              USBUART_PutData((uint8*) &settings, sizeof(settings));
 156   2          }
 157   1          
 158   1          return;   
 159   1      }
 160          
 161          void dump_data(){
 162   1          uint8  ExportBuffer[BUFFER_LEN]; // 64 Bytes per USB data packet.
 163   1          uint8* ExportPtr =(uint8*) MemoryLocation; 
 164   1          uint16 DataCnt = 0;
 165   1          uint8  i = 0;
 166   1          
 167   1          flash_LED_on();
 168   1          while (ExportPtr < TailPtr)
 169   1          {   
 170   2              while (i < BUFFER_LEN)
 171   2              {
 172   3                  if (ExportPtr < TailPtr)
 173   3                  {
 174   4                      ExportBuffer[i] = *ExportPtr; // Copy sampled data from flash at *ExportPtr to buffer for 
             -send over usb com 
 175   4                      ++i;
 176   4                      ++ExportPtr;
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 4   

 177   4                      ++DataCnt;
 178   4                  }
 179   3                  else
 180   3                  {
 181   4                      ExportBuffer[i] = PADBYTE;
 182   4                      ++i;
 183   4                  }           
 184   3              }
 185   2              
 186   2              while(!USBUART_CDCIsReady() && Vbus_Read());
 187   2              USBUART_PutData(ExportBuffer, BUFFER_LEN); // Send 64 byte packet of data from memory
 188   2              i = 0;
 189   2          }
 190   1          
 191   1          // Add the size trailer packet to get total transmission size
 192   1          DataCnt = DataCnt + 4;
 193   1          
 194   1          /* Trailer Packet to Identify End of Sampled Data in Memory */
 195   1          ExportBuffer[0] = 0x80;               // End of Data Identifier
 196   1          ExportBuffer[1] = 0x00;
 197   1          
 198   1          //2 byte Count split into two 1 byte packages to be arrayed.
 199   1          ExportBuffer[2] = (uint8)(DataCnt >> 8);;          // Count of Total Bytes Sent
 200   1          ExportBuffer[3] = (uint8)0x00FF & DataCnt;
 201   1          
 202   1          // Wait for UART to be ready
 203   1          while(!USBUART_CDCIsReady() && Vbus_Read());
 204   1          USBUART_PutData(ExportBuffer, 64u);
 205   1          
 206   1          flash_LED_off();
 207   1          
 208   1          return;
 209   1      }
 210          
 211          void send_reply(uint8 message){
 212   1         
 213   1          while(!USBUART_CDCIsReady() && Vbus_Read());
 214   1          
 215   1          if(Vbus_Read()){
 216   2              USBUART_PutData(&message, REPLY_LEN);
 217   2          }
 218   1          
 219   1          return;
 220   1      }
 221          
 222          void confirm_dump(){
 223   1          uint8 result = 0;
 224   1          uint8 command = 0;
 225   1          
 226   1          while(Vbus_Read()){
 227   2              while(!USBUART_DataIsReady() && Vbus_Read());
 228   2              
 229   2              result = retrieve(&command, COMMAND_LENGTH);
 230   2              
 231   2              if(result == SUCCESS){
 232   3                  if (command == SUCCESS){
 233   4                      TailPtr = (uint8*) MemoryLocation;
 234   4                  }
 235   3                  break;
 236   3              }
 237   2          }
 238   1          
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 5   

 239   1          return;
 240   1      }
 241          
 242          uint8 update_RTC(){
 243   1          uint8 result = FAIL;
 244   1          uint8 time_buffer[TIME_LENGTH] = {0};
 245   1          RTC_TIME_DATE new_time;
 246   1          
 247   1          while (!USBUART_DataIsReady() && Vbus_Read());
 248   1          
 249   1          if (Vbus_Read()){
 250   2              if (retrieve(time_buffer, TIME_LENGTH) == SUCCESS){
 251   3                  new_time.Year = ((uint16) time_buffer[0]) << 0x8;
 252   3                  new_time.Year = new_time.Year | ((uint16) time_buffer[1]);
 253   3                  new_time.Sec = time_buffer[2];
 254   3                  new_time.Min = time_buffer[3];
 255   3                  new_time.Hour = time_buffer[4];
 256   3                  new_time.DayOfMonth = time_buffer[5];
 257   3                  new_time.Month = time_buffer[6];
 258   3                  
 259   3                  result = sync_RTC(&new_time);
 260   3      
 261   3              }
 262   2          }
 263   1          
 264   1          return result;
 265   1      }
 266          
 267          void CMD_hard_reset(){
 268   1      
 269   1          uint8 reset_flag = 0xFF;
 270   1          
 271   1          flash_LED_on();
 272   1          Em_EEPROM_Write(&reset_flag, &hard_reset_flag, 1u);
 273   1          flash_LED_off();
 274   1          
 275   1          return;
 276   1      }
 277          
 278          void USB_Close(){
 279   1          
 280   1          EEPROM_R_Stop();
 281   1          USBUART_Stop();
 282   1          CySoftwareReset();
 283   1          
 284   1          return;
 285   1      }
 286          
 287          /* [] END OF FILE */
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 6   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION USB_ISR (BEGIN)
                                           ; SOURCE LINE # 17
                                           ; SOURCE LINE # 21
0000 900000      R     MOV     DPTR,#result
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 22
0005 900000      R     MOV     DPTR,#command
0008 E4                CLR     A
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 23
000A 120000      E     LCALL   USB_LED_on
                                           ; SOURCE LINE # 26
000D 7D01              MOV     R5,#01H
000F 7F00              MOV     R7,#00H
0011 120000      E     LCALL   _USBUART_Start
0014         ?C0001:
                                           ; SOURCE LINE # 29
0014 120000      E     LCALL   USBUART_GetConfiguration
0017 EF                MOV     A,R7
0018 7006              JNZ     ?C0002
001A 120000      E     LCALL   Vbus_Read
001D EF                MOV     A,R7
001E 70F4              JNZ     ?C0001
0020         ?C0002:
                                           ; SOURCE LINE # 32
0020 120000      E     LCALL   USBUART_CDC_Init
0023         ?C0003:
                                           ; SOURCE LINE # 34
0023 120000      E     LCALL   Vbus_Read
0026 EF                MOV     A,R7
0027 7003              JNZ     $ + 5H
0029 020000      R     LJMP    ?C0004
                                           ; SOURCE LINE # 35
                                           ; SOURCE LINE # 36
002C 120000      E     LCALL   USBUART_DataIsReady
002F EF                MOV     A,R7
0030 60F1              JZ      ?C0003
                                           ; SOURCE LINE # 37
0032 7B01              MOV     R3,#01H
0034 7A00        R     MOV     R2,#HIGH command
0036 7900        R     MOV     R1,#LOW command
0038 7D01              MOV     R5,#01H
003A 120000      R     LCALL   _retrieve
003D 900000      R     MOV     DPTR,#result
0040 EF                MOV     A,R7
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 40
0042 900000      R     MOV     DPTR,#command
0045 E0                MOVX    A,@DPTR
0046 FF                MOV     R7,A
0047 EF                MOV     A,R7
0048 60D9              JZ      ?C0003
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
004A         ?C0006:
                                           ; SOURCE LINE # 44
004A 900000      R     MOV     DPTR,#result
004D E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 7   

004E FF                MOV     R7,A
004F EF                MOV     A,R7
0050 6402              XRL     A,#02H
0052 6003              JZ      $ + 5H
0054 020000      R     LJMP    ?C0007
                                           ; SOURCE LINE # 46
0057 900000      R     MOV     DPTR,#command
005A E0                MOVX    A,@DPTR
005B FF                MOV     R7,A
005C EF                MOV     A,R7
005D 120000      E     LCALL   ?C?CCASE
0060 0000        R     DW      ?C0009
0062 01                DB      01H
0063 0000        R     DW      ?C0010
0065 02                DB      02H
0066 0000        R     DW      ?C0011
0068 03                DB      03H
0069 0000        R     DW      ?C0012
006B 04                DB      04H
006C 0000        R     DW      ?C0018
006E 05                DB      05H
006F 0000        R     DW      ?C0015
0071 06                DB      06H
0072 0000              DW      00H
0074 0000        R     DW      ?C0019
                                           ; SOURCE LINE # 48
0076         ?C0009:
                                           ; SOURCE LINE # 49
0076 7F01              MOV     R7,#01H
0078 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 50
007B 80A6              SJMP    ?C0003
                                           ; SOURCE LINE # 52
007D         ?C0010:
                                           ; SOURCE LINE # 53
007D 120000      R     LCALL   dump_data
                                           ; SOURCE LINE # 54
0080 120000      R     LCALL   confirm_dump
                                           ; SOURCE LINE # 55
0083 809E              SJMP    ?C0003
                                           ; SOURCE LINE # 57
0085         ?C0011:
                                           ; SOURCE LINE # 58
0085 120000      R     LCALL   send_settings
                                           ; SOURCE LINE # 59
0088 8099              SJMP    ?C0003
                                           ; SOURCE LINE # 61
008A         ?C0012:
                                           ; SOURCE LINE # 62
008A 7F02              MOV     R7,#02H
008C 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 63
008F 120000      R     LCALL   apply_settings
0092 EF                MOV     A,R7
0093 B40207            CJNE    A,#02H,?C0013
                                           ; SOURCE LINE # 64
0096 7F02              MOV     R7,#02H
0098 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 65
009B 8086              SJMP    ?C0003
009D         ?C0013:
                                           ; SOURCE LINE # 66
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 8   

                                           ; SOURCE LINE # 67
009D 7F03              MOV     R7,#03H
009F 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 68
00A2         ?C0014:
                                           ; SOURCE LINE # 69
00A2 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 71
00A5         ?C0015:
                                           ; SOURCE LINE # 72
00A5 7F02              MOV     R7,#02H
00A7 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 73
00AA 120000      R     LCALL   update_RTC
00AD EF                MOV     A,R7
00AE B40208            CJNE    A,#02H,?C0016
                                           ; SOURCE LINE # 74
00B1 7F02              MOV     R7,#02H
00B3 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 75
00B6 020000      R     LJMP    ?C0003
00B9         ?C0016:
                                           ; SOURCE LINE # 76
                                           ; SOURCE LINE # 77
00B9 7F03              MOV     R7,#03H
00BB 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 78
00BE         ?C0017:
                                           ; SOURCE LINE # 79
00BE 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 81
00C1         ?C0018:
                                           ; SOURCE LINE # 82
00C1 120000      E     LCALL   hard_reset
                                           ; SOURCE LINE # 83
00C4 7F02              MOV     R7,#02H
00C6 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 84
00C9 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 86
00CC         ?C0019:
                                           ; SOURCE LINE # 87
00CC 7F03              MOV     R7,#03H
00CE 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 88
00D1 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 89
00D4         ?C0008:
                                           ; SOURCE LINE # 90
00D4 020000      R     LJMP    ?C0003
00D7         ?C0007:
                                           ; SOURCE LINE # 91
                                           ; SOURCE LINE # 92
00D7 7F03              MOV     R7,#03H
00D9 120000      R     LCALL   _send_reply
                                           ; SOURCE LINE # 93
00DC         ?C0020:
                                           ; SOURCE LINE # 94
00DC         ?C0005:
                                           ; SOURCE LINE # 95
00DC 020000      R     LJMP    ?C0003
00DF         ?C0004:
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 9   

                                           ; SOURCE LINE # 97
00DF 120000      E     LCALL   USBUART_Stop
                                           ; SOURCE LINE # 98
00E2 120000      E     LCALL   USB_LED_off
                                           ; SOURCE LINE # 101
00E5         ?C0021:
00E5 22                RET     
             ; FUNCTION USB_ISR (END)

             ; FUNCTION _retrieve (BEGIN)
                                           ; SOURCE LINE # 103
0000 900000      R     MOV     DPTR,#buffer
0003 120000      E     LCALL   ?C?PSTXDATA
0006 900000      R     MOV     DPTR,#num_bytes
0009 ED                MOV     A,R5
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 104
000B 900000      R     MOV     DPTR,#count
000E E4                CLR     A
000F F0                MOVX    @DPTR,A
0010 A3                INC     DPTR
0011 E4                CLR     A
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 105
0013 900000      R     MOV     DPTR,#attempts
0016 E4                CLR     A
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 106
0018 900000      R     MOV     DPTR,#result
001B 7402              MOV     A,#02H
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 108
001E 120000      E     LCALL   USBUART_GetCount
0021 900000      R     MOV     DPTR,#count
0024 EE                MOV     A,R6
0025 F0                MOVX    @DPTR,A
0026 A3                INC     DPTR
0027 EF                MOV     A,R7
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 112
0029 900000      R     MOV     DPTR,#num_bytes
002C E0                MOVX    A,@DPTR
002D FF                MOV     R7,A
002E 7E00              MOV     R6,#00H
0030 900000      R     MOV     DPTR,#count
0033 E0                MOVX    A,@DPTR
0034 FC                MOV     R4,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FD                MOV     R5,A
0038 EF                MOV     A,R7
0039 B50518            CJNE    A,AR5,?C0022
003C EE                MOV     A,R6
003D B50414            CJNE    A,AR4,?C0022
                                           ; SOURCE LINE # 113
0040 900000      R     MOV     DPTR,#buffer
0043 120000      E     LCALL   ?C?PLDXDATA
0046 900000      R     MOV     DPTR,#num_bytes
0049 E0                MOVX    A,@DPTR
004A FF                MOV     R7,A
004B EF                MOV     A,R7
004C FD                MOV     R5,A
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 10  

004D 7C00              MOV     R4,#00H
004F 120000      E     LCALL   _USBUART_GetData
                                           ; SOURCE LINE # 114
0052 8009              SJMP    ?C0023
0054         ?C0022:
                                           ; SOURCE LINE # 116
                                           ; SOURCE LINE # 117
0054 120000      E     LCALL   USBUART_GetChar
                                           ; SOURCE LINE # 118
0057 900000      R     MOV     DPTR,#result
005A 7403              MOV     A,#03H
005C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 119
005D         ?C0023:
                                           ; SOURCE LINE # 121
005D 900000      R     MOV     DPTR,#result
0060 E0                MOVX    A,@DPTR
0061 FF                MOV     R7,A
                                           ; SOURCE LINE # 122
0062         ?C0024:
0062 22                RET     
             ; FUNCTION _retrieve (END)

             ; FUNCTION apply_settings (BEGIN)
                                           ; SOURCE LINE # 124
                                           ; SOURCE LINE # 125
0000 900000      R     MOV     DPTR,#result
0003 7403              MOV     A,#03H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 126
0006 7BFF              MOV     R3,#0FFH
0008 7A00        R     MOV     R2,#HIGH _?ix1000
000A 7900        R     MOV     R1,#LOW _?ix1000
000C C003              PUSH    AR3
000E C002              PUSH    AR2
0010 C001              PUSH    AR1
0012 7B01              MOV     R3,#01H
0014 7A00        R     MOV     R2,#HIGH settings_buffer
0016 7900        R     MOV     R1,#LOW settings_buffer
0018 A801              MOV     R0,AR1
001A AC02              MOV     R4,AR2
001C AD03              MOV     R5,AR3
001E D001              POP     AR1
0020 D002              POP     AR2
0022 D003              POP     AR3
0024 7E00              MOV     R6,#00H
0026 7F03              MOV     R7,#03H
0028 120000      E     LCALL   ?C?COPYAMD
002B         ?C0025:
                                           ; SOURCE LINE # 129
002B 120000      E     LCALL   USBUART_DataIsReady
002E EF                MOV     A,R7
002F 7006              JNZ     ?C0026
0031 120000      E     LCALL   Vbus_Read
0034 EF                MOV     A,R7
0035 70F4              JNZ     ?C0025
0037         ?C0026:
                                           ; SOURCE LINE # 131
0037 120000      E     LCALL   Vbus_Read
003A EF                MOV     A,R7
003B 605B              JZ      ?C0027
                                           ; SOURCE LINE # 132
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 11  

003D 7B01              MOV     R3,#01H
003F 7A00        R     MOV     R2,#HIGH settings_buffer
0041 7900        R     MOV     R1,#LOW settings_buffer
0043 7D03              MOV     R5,#03H
0045 120000      R     LCALL   _retrieve
0048 EF                MOV     A,R7
0049 6402              XRL     A,#02H
004B 704B              JNZ     ?C0027
                                           ; SOURCE LINE # 133
004D 900000      R     MOV     DPTR,#settings_buffer
0050 E0                MOVX    A,@DPTR
0051 FF                MOV     R7,A
0052 900000      R     MOV     DPTR,#new_settings
0055 EF                MOV     A,R7
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 134
0057 900000      R     MOV     DPTR,#settings_buffer+01H
005A E0                MOVX    A,@DPTR
005B FF                MOV     R7,A
005C 900000      R     MOV     DPTR,#new_settings+01H
005F EF                MOV     A,R7
0060 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 135
0061 900000      R     MOV     DPTR,#settings_buffer+02H
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 900000      R     MOV     DPTR,#new_settings+02H
0069 EF                MOV     A,R7
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 137
006B 7B01              MOV     R3,#01H
006D 7A00        R     MOV     R2,#HIGH new_settings
006F 7900        R     MOV     R1,#LOW new_settings
0071 C003              PUSH    AR3
0073 C002              PUSH    AR2
0075 C001              PUSH    AR1
0077 7B01              MOV     R3,#01H
0079 7A00        E     MOV     R2,#HIGH ?update_settings?BYTE
007B 7900        E     MOV     R1,#LOW ?update_settings?BYTE
007D A801              MOV     R0,AR1
007F AC02              MOV     R4,AR2
0081 AD03              MOV     R5,AR3
0083 D001              POP     AR1
0085 D002              POP     AR2
0087 D003              POP     AR3
0089 7E00              MOV     R6,#00H
008B 7F03              MOV     R7,#03H
008D 120000      E     LCALL   ?C?COPYAMD
0090 120000      E     LCALL   update_settings
0093 900000      R     MOV     DPTR,#result
0096 EF                MOV     A,R7
0097 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 138
0098         ?C0028:
                                           ; SOURCE LINE # 139
0098         ?C0027:
                                           ; SOURCE LINE # 141
0098 900000      R     MOV     DPTR,#result
009B E0                MOVX    A,@DPTR
009C FF                MOV     R7,A
                                           ; SOURCE LINE # 142
009D         ?C0029:
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 12  

009D 22                RET     
             ; FUNCTION apply_settings (END)

             ; FUNCTION send_settings (BEGIN)
                                           ; SOURCE LINE # 144
                                           ; SOURCE LINE # 148
0000 7F00              MOV     R7,#00H
0002 7E00              MOV     R6,#00H
0004 120000      E     LCALL   _get_variable
0007 900000      R     MOV     DPTR,#settings
000A EF                MOV     A,R7
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 149
000C 7F01              MOV     R7,#01H
000E 7E00              MOV     R6,#00H
0010 120000      E     LCALL   _get_variable
0013 900000      R     MOV     DPTR,#settings+01H
0016 EF                MOV     A,R7
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 150
0018 7F02              MOV     R7,#02H
001A 7E00              MOV     R6,#00H
001C 120000      E     LCALL   _get_variable
001F 900000      R     MOV     DPTR,#settings+02H
0022 EF                MOV     A,R7
0023 F0                MOVX    @DPTR,A
0024         ?C0030:
                                           ; SOURCE LINE # 152
0024 120000      E     LCALL   USBUART_CDCIsReady
0027 EF                MOV     A,R7
0028 7006              JNZ     ?C0031
002A 120000      E     LCALL   Vbus_Read
002D EF                MOV     A,R7
002E 70F4              JNZ     ?C0030
0030         ?C0031:
                                           ; SOURCE LINE # 154
0030 120000      E     LCALL   Vbus_Read
0033 EF                MOV     A,R7
0034 600D              JZ      ?C0033
                                           ; SOURCE LINE # 155
0036 7B01              MOV     R3,#01H
0038 7A00        R     MOV     R2,#HIGH settings
003A 7900        R     MOV     R1,#LOW settings
003C 7D03              MOV     R5,#03H
003E 7C00              MOV     R4,#00H
0040 120000      E     LCALL   _USBUART_PutData
                                           ; SOURCE LINE # 156
0043         ?C0032:
                                           ; SOURCE LINE # 159
0043         ?C0033:
0043 22                RET     
             ; FUNCTION send_settings (END)

             ; FUNCTION dump_data (BEGIN)
                                           ; SOURCE LINE # 161
                                           ; SOURCE LINE # 163
0000 7BFF              MOV     R3,#0FFH
0002 7A00        E     MOV     R2,#HIGH MemoryLocation
0004 7900        E     MOV     R1,#LOW MemoryLocation
0006 900000      R     MOV     DPTR,#ExportPtr
0009 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 164
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 13  

000C 900000      R     MOV     DPTR,#DataCnt
000F E4                CLR     A
0010 F0                MOVX    @DPTR,A
0011 A3                INC     DPTR
0012 E4                CLR     A
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 165
0014 900000      R     MOV     DPTR,#i
0017 E4                CLR     A
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 167
0019 120000      E     LCALL   flash_LED_on
001C         ?C0034:
                                           ; SOURCE LINE # 168
001C 900000      E     MOV     DPTR,#TailPtr
001F 120000      E     LCALL   ?C?PLDXDATA
0022 C003              PUSH    AR3
0024 C002              PUSH    AR2
0026 C001              PUSH    AR1
0028 900000      R     MOV     DPTR,#ExportPtr
002B 120000      E     LCALL   ?C?PLDXDATA
002E C3                CLR     C
002F D082              POP     DPL
0031 D083              POP     DPH
0033 D0E0              POP     ACC
0035 E9                MOV     A,R1
0036 9582              SUBB    A,DPL
0038 EA                MOV     A,R2
0039 9583              SUBB    A,DPH
003B         ?C0064:
003B 4003              JC      $ + 5H
003D 020000      R     LJMP    ?C0035
                                           ; SOURCE LINE # 169
0040         ?C0036:
                                           ; SOURCE LINE # 170
0040 900000      R     MOV     DPTR,#i
0043 E0                MOVX    A,@DPTR
0044 FF                MOV     R7,A
0045 EF                MOV     A,R7
0046 C3                CLR     C
0047 9440              SUBB    A,#040H
0049 5072              JNC     ?C0040
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 172
004B 900000      E     MOV     DPTR,#TailPtr
004E 120000      E     LCALL   ?C?PLDXDATA
0051 C003              PUSH    AR3
0053 C002              PUSH    AR2
0055 C001              PUSH    AR1
0057 900000      R     MOV     DPTR,#ExportPtr
005A 120000      E     LCALL   ?C?PLDXDATA
005D C3                CLR     C
005E D082              POP     DPL
0060 D083              POP     DPH
0062 D0E0              POP     ACC
0064 E9                MOV     A,R1
0065 9582              SUBB    A,DPL
0067 EA                MOV     A,R2
0068 9583              SUBB    A,DPH
006A         ?C0065:
006A 5037              JNC     ?C0038
                                           ; SOURCE LINE # 173
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 14  

                                           ; SOURCE LINE # 174
006C 900000      R     MOV     DPTR,#ExportPtr
006F 120000      E     LCALL   ?C?PLDXDATA
0072 120000      E     LCALL   ?C?CLDPTR
0075 FF                MOV     R7,A
0076 900000      R     MOV     DPTR,#i
0079 E0                MOVX    A,@DPTR
007A FE                MOV     R6,A
007B 7400        R     MOV     A,#LOW ExportBuffer
007D 2E                ADD     A,R6
007E F582              MOV     DPL,A
0080 E4                CLR     A
0081 3400        R     ADDC    A,#HIGH ExportBuffer
0083 F583              MOV     DPH,A
0085 EF                MOV     A,R7
0086 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 175
0087 900000      R     MOV     DPTR,#i
008A E0                MOVX    A,@DPTR
008B 04                INC     A
008C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 176
008D 900000      R     MOV     DPTR,#ExportPtr+01H
0090 E4                CLR     A
0091 75F001            MOV     B,#01H
0094 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 177
0097 900000      R     MOV     DPTR,#DataCnt
009A E4                CLR     A
009B 75F001            MOV     B,#01H
009E 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 178
00A1 809D              SJMP    ?C0036
00A3         ?C0038:
                                           ; SOURCE LINE # 180
                                           ; SOURCE LINE # 181
00A3 900000      R     MOV     DPTR,#i
00A6 E0                MOVX    A,@DPTR
00A7 FF                MOV     R7,A
00A8 7400        R     MOV     A,#LOW ExportBuffer
00AA 2F                ADD     A,R7
00AB F582              MOV     DPL,A
00AD E4                CLR     A
00AE 3400        R     ADDC    A,#HIGH ExportBuffer
00B0 F583              MOV     DPH,A
00B2 7440              MOV     A,#040H
00B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 182
00B5 900000      R     MOV     DPTR,#i
00B8 E0                MOVX    A,@DPTR
00B9 04                INC     A
00BA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 183
00BB         ?C0039:
                                           ; SOURCE LINE # 184
00BB 8083              SJMP    ?C0036
00BD         ?C0037:
00BD         ?C0040:
                                           ; SOURCE LINE # 186
00BD 120000      E     LCALL   USBUART_CDCIsReady
00C0 EF                MOV     A,R7
00C1 7006              JNZ     ?C0041
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 15  

00C3 120000      E     LCALL   Vbus_Read
00C6 EF                MOV     A,R7
00C7 70F4              JNZ     ?C0040
00C9         ?C0041:
                                           ; SOURCE LINE # 187
00C9 7B01              MOV     R3,#01H
00CB 7A00        R     MOV     R2,#HIGH ExportBuffer
00CD 7900        R     MOV     R1,#LOW ExportBuffer
00CF 7D40              MOV     R5,#040H
00D1 7C00              MOV     R4,#00H
00D3 120000      E     LCALL   _USBUART_PutData
                                           ; SOURCE LINE # 188
00D6 900000      R     MOV     DPTR,#i
00D9 E4                CLR     A
00DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 189
00DB 020000      R     LJMP    ?C0034
00DE         ?C0035:
                                           ; SOURCE LINE # 192
00DE 900000      R     MOV     DPTR,#DataCnt
00E1 E4                CLR     A
00E2 75F004            MOV     B,#04H
00E5 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 195
00E8 900000      R     MOV     DPTR,#ExportBuffer
00EB 7480              MOV     A,#080H
00ED F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 196
00EE 900000      R     MOV     DPTR,#ExportBuffer+01H
00F1 E4                CLR     A
00F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 199
00F3 900000      R     MOV     DPTR,#DataCnt
00F6 E0                MOVX    A,@DPTR
00F7 FE                MOV     R6,A
00F8 A3                INC     DPTR
00F9 E0                MOVX    A,@DPTR
00FA FF                MOV     R7,A
00FB EE                MOV     A,R6
00FC FF                MOV     R7,A
00FD 7E00              MOV     R6,#00H
00FF 900000      R     MOV     DPTR,#ExportBuffer+02H
0102 EF                MOV     A,R7
0103 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 200
0104 900000      R     MOV     DPTR,#DataCnt
0107 E0                MOVX    A,@DPTR
0108 FE                MOV     R6,A
0109 A3                INC     DPTR
010A E0                MOVX    A,@DPTR
010B FF                MOV     R7,A
010C EF                MOV     A,R7
010D 54FF              ANL     A,#0FFH
010F FF                MOV     R7,A
0110 900000      R     MOV     DPTR,#ExportBuffer+03H
0113 EF                MOV     A,R7
0114 F0                MOVX    @DPTR,A
0115         ?C0042:
                                           ; SOURCE LINE # 203
0115 120000      E     LCALL   USBUART_CDCIsReady
0118 EF                MOV     A,R7
0119 7006              JNZ     ?C0043
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 16  

011B 120000      E     LCALL   Vbus_Read
011E EF                MOV     A,R7
011F 70F4              JNZ     ?C0042
0121         ?C0043:
                                           ; SOURCE LINE # 204
0121 7B01              MOV     R3,#01H
0123 7A00        R     MOV     R2,#HIGH ExportBuffer
0125 7900        R     MOV     R1,#LOW ExportBuffer
0127 7D40              MOV     R5,#040H
0129 7C00              MOV     R4,#00H
012B 120000      E     LCALL   _USBUART_PutData
                                           ; SOURCE LINE # 206
012E 120000      E     LCALL   flash_LED_off
                                           ; SOURCE LINE # 209
0131         ?C0044:
0131 22                RET     
             ; FUNCTION dump_data (END)

             ; FUNCTION _send_reply (BEGIN)
                                           ; SOURCE LINE # 211
0000 900000      R     MOV     DPTR,#message
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005         ?C0045:
                                           ; SOURCE LINE # 213
0005 120000      E     LCALL   USBUART_CDCIsReady
0008 EF                MOV     A,R7
0009 7006              JNZ     ?C0046
000B 120000      E     LCALL   Vbus_Read
000E EF                MOV     A,R7
000F 70F4              JNZ     ?C0045
0011         ?C0046:
                                           ; SOURCE LINE # 215
0011 120000      E     LCALL   Vbus_Read
0014 EF                MOV     A,R7
0015 600D              JZ      ?C0048
                                           ; SOURCE LINE # 216
0017 7B01              MOV     R3,#01H
0019 7A00        R     MOV     R2,#HIGH message
001B 7900        R     MOV     R1,#LOW message
001D 7D01              MOV     R5,#01H
001F 7C00              MOV     R4,#00H
0021 120000      E     LCALL   _USBUART_PutData
                                           ; SOURCE LINE # 217
0024         ?C0047:
                                           ; SOURCE LINE # 220
0024         ?C0048:
0024 22                RET     
             ; FUNCTION _send_reply (END)

             ; FUNCTION confirm_dump (BEGIN)
                                           ; SOURCE LINE # 222
                                           ; SOURCE LINE # 223
0000 900000      R     MOV     DPTR,#result
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 224
0005 900000      R     MOV     DPTR,#command
0008 E4                CLR     A
0009 F0                MOVX    @DPTR,A
000A         ?C0049:
                                           ; SOURCE LINE # 226
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 17  

000A 120000      E     LCALL   Vbus_Read
000D EF                MOV     A,R7
000E 603D              JZ      ?C0055
0010         ?C0051:
                                           ; SOURCE LINE # 227
0010 120000      E     LCALL   USBUART_DataIsReady
0013 EF                MOV     A,R7
0014 7006              JNZ     ?C0052
0016 120000      E     LCALL   Vbus_Read
0019 EF                MOV     A,R7
001A 70F4              JNZ     ?C0051
001C         ?C0052:
                                           ; SOURCE LINE # 229
001C 7B01              MOV     R3,#01H
001E 7A00        R     MOV     R2,#HIGH command
0020 7900        R     MOV     R1,#LOW command
0022 7D01              MOV     R5,#01H
0024 120000      R     LCALL   _retrieve
0027 900000      R     MOV     DPTR,#result
002A EF                MOV     A,R7
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 231
002C 900000      R     MOV     DPTR,#result
002F E0                MOVX    A,@DPTR
0030 FF                MOV     R7,A
0031 EF                MOV     A,R7
0032 B402D5            CJNE    A,#02H,?C0049
                                           ; SOURCE LINE # 232
0035 900000      R     MOV     DPTR,#command
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B B4020F            CJNE    A,#02H,?C0055
                                           ; SOURCE LINE # 233
003E 7BFF              MOV     R3,#0FFH
0040 7A00        E     MOV     R2,#HIGH MemoryLocation
0042 7900        E     MOV     R1,#LOW MemoryLocation
0044 900000      E     MOV     DPTR,#TailPtr
0047 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 234
004A         ?C0054:
                                           ; SOURCE LINE # 235
004A 22                RET     
                                           ; SOURCE LINE # 236
004B         ?C0053:
                                           ; SOURCE LINE # 237
004B 80BD              SJMP    ?C0049
004D         ?C0050:
                                           ; SOURCE LINE # 240
004D         ?C0055:
004D 22                RET     
             ; FUNCTION confirm_dump (END)

             ; FUNCTION update_RTC (BEGIN)
                                           ; SOURCE LINE # 242
                                           ; SOURCE LINE # 243
0000 900000      R     MOV     DPTR,#result
0003 7403              MOV     A,#03H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 244
0006 7BFF              MOV     R3,#0FFH
0008 7A00        R     MOV     R2,#HIGH _?ix1001
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 18  

000A 7900        R     MOV     R1,#LOW _?ix1001
000C C003              PUSH    AR3
000E C002              PUSH    AR2
0010 C001              PUSH    AR1
0012 7B01              MOV     R3,#01H
0014 7A00        R     MOV     R2,#HIGH time_buffer
0016 7900        R     MOV     R1,#LOW time_buffer
0018 A801              MOV     R0,AR1
001A AC02              MOV     R4,AR2
001C AD03              MOV     R5,AR3
001E D001              POP     AR1
0020 D002              POP     AR2
0022 D003              POP     AR3
0024 7E00              MOV     R6,#00H
0026 7F07              MOV     R7,#07H
0028 120000      E     LCALL   ?C?COPYAMD
002B         ?C0056:
                                           ; SOURCE LINE # 247
002B 120000      E     LCALL   USBUART_DataIsReady
002E EF                MOV     A,R7
002F 7006              JNZ     ?C0057
0031 120000      E     LCALL   Vbus_Read
0034 EF                MOV     A,R7
0035 70F4              JNZ     ?C0056
0037         ?C0057:
                                           ; SOURCE LINE # 249
0037 120000      E     LCALL   Vbus_Read
003A EF                MOV     A,R7
003B 7003              JNZ     $ + 5H
003D 020000      R     LJMP    ?C0058
                                           ; SOURCE LINE # 250
0040 7B01              MOV     R3,#01H
0042 7A00        R     MOV     R2,#HIGH time_buffer
0044 7900        R     MOV     R1,#LOW time_buffer
0046 7D07              MOV     R5,#07H
0048 120000      R     LCALL   _retrieve
004B EF                MOV     A,R7
004C 6402              XRL     A,#02H
004E 7070              JNZ     ?C0058
                                           ; SOURCE LINE # 251
0050 900000      R     MOV     DPTR,#time_buffer
0053 E0                MOVX    A,@DPTR
0054 FF                MOV     R7,A
0055 7E00              MOV     R6,#00H
0057 EF                MOV     A,R7
0058 7F00              MOV     R7,#00H
005A FE                MOV     R6,A
005B 900000      R     MOV     DPTR,#new_time+08H
005E EE                MOV     A,R6
005F F0                MOVX    @DPTR,A
0060 A3                INC     DPTR
0061 EF                MOV     A,R7
0062 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 252
0063 900000      R     MOV     DPTR,#time_buffer+01H
0066 E0                MOVX    A,@DPTR
0067 FF                MOV     R7,A
0068 7E00              MOV     R6,#00H
006A 900000      R     MOV     DPTR,#new_time+08H
006D E0                MOVX    A,@DPTR
006E FC                MOV     R4,A
006F A3                INC     DPTR
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 19  

0070 E0                MOVX    A,@DPTR
0071 FD                MOV     R5,A
0072 EE                MOV     A,R6
0073 4C                ORL     A,R4
0074 FE                MOV     R6,A
0075 EF                MOV     A,R7
0076 4D                ORL     A,R5
0077 FF                MOV     R7,A
0078 900000      R     MOV     DPTR,#new_time+08H
007B EE                MOV     A,R6
007C F0                MOVX    @DPTR,A
007D A3                INC     DPTR
007E EF                MOV     A,R7
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 253
0080 900000      R     MOV     DPTR,#time_buffer+02H
0083 E0                MOVX    A,@DPTR
0084 FF                MOV     R7,A
0085 900000      R     MOV     DPTR,#new_time
0088 EF                MOV     A,R7
0089 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 254
008A 900000      R     MOV     DPTR,#time_buffer+03H
008D E0                MOVX    A,@DPTR
008E FF                MOV     R7,A
008F 900000      R     MOV     DPTR,#new_time+01H
0092 EF                MOV     A,R7
0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 255
0094 900000      R     MOV     DPTR,#time_buffer+04H
0097 E0                MOVX    A,@DPTR
0098 FF                MOV     R7,A
0099 900000      R     MOV     DPTR,#new_time+02H
009C EF                MOV     A,R7
009D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 256
009E 900000      R     MOV     DPTR,#time_buffer+05H
00A1 E0                MOVX    A,@DPTR
00A2 FF                MOV     R7,A
00A3 900000      R     MOV     DPTR,#new_time+04H
00A6 EF                MOV     A,R7
00A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 257
00A8 900000      R     MOV     DPTR,#time_buffer+06H
00AB E0                MOVX    A,@DPTR
00AC FF                MOV     R7,A
00AD 900000      R     MOV     DPTR,#new_time+07H
00B0 EF                MOV     A,R7
00B1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 259
00B2 7B01              MOV     R3,#01H
00B4 7A00        R     MOV     R2,#HIGH new_time
00B6 7900        R     MOV     R1,#LOW new_time
00B8 120000      E     LCALL   _sync_RTC
00BB 900000      R     MOV     DPTR,#result
00BE EF                MOV     A,R7
00BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 261
00C0         ?C0059:
                                           ; SOURCE LINE # 262
00C0         ?C0058:
                                           ; SOURCE LINE # 264
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 20  

00C0 900000      R     MOV     DPTR,#result
00C3 E0                MOVX    A,@DPTR
00C4 FF                MOV     R7,A
                                           ; SOURCE LINE # 265
00C5         ?C0060:
00C5 22                RET     
             ; FUNCTION update_RTC (END)

             ; FUNCTION CMD_hard_reset (BEGIN)
                                           ; SOURCE LINE # 267
                                           ; SOURCE LINE # 269
0000 900000      R     MOV     DPTR,#reset_flag
0003 74FF              MOV     A,#0FFH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 271
0006 120000      E     LCALL   flash_LED_on
                                           ; SOURCE LINE # 272
0009 7B01              MOV     R3,#01H
000B 7A00        R     MOV     R2,#HIGH reset_flag
000D 7900        R     MOV     R1,#LOW reset_flag
000F C003              PUSH    AR3
0011 C002              PUSH    AR2
0013 C001              PUSH    AR1
0015 7BFF              MOV     R3,#0FFH
0017 7A00        E     MOV     R2,#HIGH hard_reset_flag
0019 7900        E     MOV     R1,#LOW hard_reset_flag
001B 900000      E     MOV     DPTR,#?_Em_EEPROM_Write?BYTE+03H
001E 120000      E     LCALL   ?C?PSTXDATA
0021 900000      E     MOV     DPTR,#?_Em_EEPROM_Write?BYTE+06H
0024 E4                CLR     A
0025 F0                MOVX    @DPTR,A
0026 A3                INC     DPTR
0027 7401              MOV     A,#01H
0029 F0                MOVX    @DPTR,A
002A D001              POP     AR1
002C D002              POP     AR2
002E D003              POP     AR3
0030 120000      E     LCALL   _Em_EEPROM_Write
                                           ; SOURCE LINE # 273
0033 120000      E     LCALL   flash_LED_off
                                           ; SOURCE LINE # 276
0036         ?C0061:
0036 22                RET     
             ; FUNCTION CMD_hard_reset (END)

             ; FUNCTION USB_Close (BEGIN)
                                           ; SOURCE LINE # 278
                                           ; SOURCE LINE # 280
0000 120000      E     LCALL   EEPROM_R_Stop
                                           ; SOURCE LINE # 281
0003 120000      E     LCALL   USBUART_Stop
                                           ; SOURCE LINE # 282
0006 120000      E     LCALL   CySoftwareReset
                                           ; SOURCE LINE # 285
0009         ?C0062:
0009 22                RET     
             ; FUNCTION USB_Close (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1239    ----
C51 COMPILER V9.51   USB_ACCESS                                                            05/02/2014 00:28:16 PAGE 21  

   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =    112    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
