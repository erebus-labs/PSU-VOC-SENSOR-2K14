C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Debug\main.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\main.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051_Keil_951\Debug\main.lst) CD DB NOIP OT(3,SPEED) INCDIR(.,.\Generated_S
                    -ource\PSoC3) OJ(.\DP8051_Keil_951\Debug\main.obj)

line level    source

   1          /*******************************************************************************
   2          * File Name: main.c
   3          *
   4          * Version: 1.10
   5          *
   6          * Description:
   7          *  This is a source code for Erase and Write funtionality of EEPROM component.
   8          *
   9          ********************************************************************************
  10          * Copyright 2012, Cypress Semiconductor Corporation. All rights reserved.
  11          * This software is owned by Cypress Semiconductor Corporation and is protected
  12          * by and subject to worldwide patent and copyright laws and treaties.
  13          * Therefore, you may use this software only as provided in the license agreement
  14          * accompanying the software package from which you obtained this software.
  15          * CYPRESS AND ITS SUPPLIERS MAKE NO WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
  16          * WITH REGARD TO THIS SOFTWARE, INCLUDING, BUT NOT LIMITED TO, NONINFRINGEMENT,
  17          * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
  18          *******************************************************************************/
  19          
  20          #include <device.h>
  21          #include <project.h>
  22          
  23          
  24          /*******************************************************************************
  25          * Function Name: main
  26          ********************************************************************************
  27          *
  28          * Summary:
  29          * Main function performs the following functions:
  30          *  1: Start the EEPROM (Only for CY_PSOC3 or later)
  31          *  2: Initializes the LCD
  32          *  3: Print data written to eeprom memory in LCD
  33          *  4: Print result of test in LCD
  34          *
  35          * Parameters:
  36          *  None.
  37          *
  38          * Return:
  39          *  None.
  40          *
  41          *******************************************************************************/
  42          void main()
  43          {
  44   1          uint16 Index;
  45   1          reg8 * RegPointer;
  46   1          int err = 0u;
  47   1          cystatus eraseStatus;
  48   1          cystatus writeStatus;
  49   1          uint8 TestData1[SIZEOF_EEPROM_ROW] = {1u, 2u, 2u, 4u, 5u, 1u, 2u, 3u, 4u, 6u, 9u, 2u, 5u, 4u, 5u, 4u};
  50   1      
  51   1          /* Prepare components */
  52   1          #if (CY_PSOC3 || CY_PSOC5LP) 
  53   1              EEPROM_Start();
C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 2   

  54   1          #endif /* (CY_PSOC3 || CY_PSOC5LP) */
  55   1      
  56   1          CharLCD_1_Start();
  57   1          eraseStatus = 0xff;
  58   1          writeStatus = 0xff;
  59   1      
  60   1          /* Erase all sectors. */
  61   1          for(Index = 0u; Index < CY_EEPROM_NUMBER_ARRAYS; Index++)
  62   1          {
  63   2              eraseStatus = EEPROM_EraseSector(Index);
  64   2          }
  65   1      
  66   1          /* Check that all EEPROM is zero */
  67   1          RegPointer = (reg8 *)CYDEV_EE_BASE;
  68   1          for(Index = 0u; Index < EEPROM_EEPROM_SIZE; Index++)
  69   1          {
  70   2              if(RegPointer[Index] != 0u)
  71   2              {
  72   3                  CharLCD_1_Position(1u, 0u);
  73   3                  CharLCD_1_PrintString("ERASE FAILED");
  74   3                  err ++;
  75   3              }
  76   2          }
  77   1      
  78   1          /* Get the die temp. */
  79   1          if(CySetTemp() == CYRET_SUCCESS)
  80   1          {
  81   2              /* Write TestData1 to EEPROM row 0 */
  82   2              writeStatus = EEPROM_Write(TestData1, 0u);
  83   2          }
  84   1      
  85   1          /* Check Data */
  86   1          RegPointer = (reg8 *) CYDEV_EE_BASE;
  87   1          for(Index = 0u; Index < SIZEOF_EEPROM_ROW; Index++)
  88   1          {
  89   2              if(TestData1[Index] != RegPointer[Index])
  90   2              {
  91   3                  CharLCD_1_Position(1u, 0u);
  92   3                  CharLCD_1_PrintString("WRITE FAILED");
  93   3                  err ++;
  94   3              }
  95   2              CharLCD_1_Position(0u, 0u);
  96   2              CharLCD_1_PrintInt8(RegPointer[Index]);
  97   2              CyDelay(500u);
  98   2          }
  99   1      
 100   1          if(eraseStatus == CYRET_SUCCESS && writeStatus == CYRET_SUCCESS && err == 0u)
 101   1          {
 102   2              CharLCD_1_Position(1u, 0u);
 103   2              CharLCD_1_PrintString("EEPROM TEST PASSED");
 104   2          }
 105   1          else
 106   1          {
 107   2              CharLCD_1_Position(1u, 0u);
 108   2              CharLCD_1_PrintString("EEPROM TEST FAILED");
 109   2          }
 110   1      
 111   1          for(;;)
 112   1          {
 113   2          }
 114   1      }
 115          
C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 3   

 116          
 117          /* [] END OF FILE */
C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 4   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 43
                                           ; SOURCE LINE # 46
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#err
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 49
0007 7BFF              MOV     R3,#0FFH
0009 7A00        R     MOV     R2,#HIGH _?ix1000
000B 7900        R     MOV     R1,#LOW _?ix1000
000D 7800        R     MOV     R0,#LOW TestData1
000F 7C00        R     MOV     R4,#HIGH TestData1
0011 7D01              MOV     R5,#01H
0013 FE                MOV     R6,A
0014 7F10              MOV     R7,#010H
0016 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 53
0019 120000      E     LCALL   EEPROM_Start
                                           ; SOURCE LINE # 56
001C 120000      E     LCALL   CharLCD_1_Start
                                           ; SOURCE LINE # 57
001F 900000      R     MOV     DPTR,#eraseStatus
0022 74FF              MOV     A,#0FFH
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 58
0025 A3                INC     DPTR
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 61
0027 E4                CLR     A
0028 900000      R     MOV     DPTR,#Index
002B F0                MOVX    @DPTR,A
002C A3                INC     DPTR
002D F0                MOVX    @DPTR,A
002E         ?C0001:
002E 900000      R     MOV     DPTR,#Index
0031 E0                MOVX    A,@DPTR
0032 FE                MOV     R6,A
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 C3                CLR     C
0036 9402              SUBB    A,#02H
0038 EE                MOV     A,R6
0039 9400              SUBB    A,#00H
003B 501F              JNC     ?C0002
                                           ; SOURCE LINE # 62
                                           ; SOURCE LINE # 63
003D 900000      R     MOV     DPTR,#Index
0040 E0                MOVX    A,@DPTR
0041 A3                INC     DPTR
0042 E0                MOVX    A,@DPTR
0043 FF                MOV     R7,A
0044 120000      E     LCALL   _EEPROM_EraseSector
0047 900000      R     MOV     DPTR,#eraseStatus
004A EF                MOV     A,R7
004B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 64
C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 5   

004C 900000      R     MOV     DPTR,#Index+01H
004F E0                MOVX    A,@DPTR
0050 04                INC     A
0051 F0                MOVX    @DPTR,A
0052 7006              JNZ     ?C0018
0054 900000      R     MOV     DPTR,#Index
0057 E0                MOVX    A,@DPTR
0058 04                INC     A
0059 F0                MOVX    @DPTR,A
005A         ?C0018:
005A 80D2              SJMP    ?C0001
005C         ?C0002:
                                           ; SOURCE LINE # 67
005C 900000      R     MOV     DPTR,#RegPointer
005F 7480              MOV     A,#080H
0061 F0                MOVX    @DPTR,A
0062 A3                INC     DPTR
0063 E4                CLR     A
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 68
0065 900000      R     MOV     DPTR,#Index
0068 F0                MOVX    @DPTR,A
0069 A3                INC     DPTR
006A F0                MOVX    @DPTR,A
006B         ?C0004:
006B 900000      R     MOV     DPTR,#Index
006E E0                MOVX    A,@DPTR
006F FE                MOV     R6,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 C3                CLR     C
0073 EE                MOV     A,R6
0074 9408              SUBB    A,#08H
0076 5044              JNC     ?C0005
                                           ; SOURCE LINE # 69
                                           ; SOURCE LINE # 70
0078 900000      R     MOV     DPTR,#Index
007B E0                MOVX    A,@DPTR
007C A3                INC     DPTR
007D E0                MOVX    A,@DPTR
007E FF                MOV     R7,A
007F A3                INC     DPTR
0080 E0                MOVX    A,@DPTR
0081 FC                MOV     R4,A
0082 A3                INC     DPTR
0083 E0                MOVX    A,@DPTR
0084 2F                ADD     A,R7
0085 F582              MOV     DPL,A
0087 EC                MOV     A,R4
0088 3E                ADDC    A,R6
0089 F583              MOV     DPH,A
008B E0                MOVX    A,@DPTR
008C 601E              JZ      ?C0006
                                           ; SOURCE LINE # 71
                                           ; SOURCE LINE # 72
008E E4                CLR     A
008F FD                MOV     R5,A
0090 7F01              MOV     R7,#01H
0092 120000      E     LCALL   _CharLCD_1_Position
                                           ; SOURCE LINE # 73
0095 7BFF              MOV     R3,#0FFH
0097 7A00        R     MOV     R2,#HIGH ?SC_0
C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 6   

0099 7900        R     MOV     R1,#LOW ?SC_0
009B 120000      E     LCALL   _CharLCD_1_PrintString
                                           ; SOURCE LINE # 74
009E 900000      R     MOV     DPTR,#err+01H
00A1 E0                MOVX    A,@DPTR
00A2 04                INC     A
00A3 F0                MOVX    @DPTR,A
00A4 7006              JNZ     ?C0019
00A6 900000      R     MOV     DPTR,#err
00A9 E0                MOVX    A,@DPTR
00AA 04                INC     A
00AB F0                MOVX    @DPTR,A
00AC         ?C0019:
                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 76
00AC         ?C0006:
00AC 900000      R     MOV     DPTR,#Index+01H
00AF E0                MOVX    A,@DPTR
00B0 04                INC     A
00B1 F0                MOVX    @DPTR,A
00B2 7006              JNZ     ?C0020
00B4 900000      R     MOV     DPTR,#Index
00B7 E0                MOVX    A,@DPTR
00B8 04                INC     A
00B9 F0                MOVX    @DPTR,A
00BA         ?C0020:
00BA 80AF              SJMP    ?C0004
00BC         ?C0005:
                                           ; SOURCE LINE # 79
00BC 120000      E     LCALL   CySetTemp
00BF EF                MOV     A,R7
00C0 700F              JNZ     ?C0008
                                           ; SOURCE LINE # 80
                                           ; SOURCE LINE # 82
00C2 7B01              MOV     R3,#01H
00C4 7A00        R     MOV     R2,#HIGH TestData1
00C6 7900        R     MOV     R1,#LOW TestData1
00C8 FD                MOV     R5,A
00C9 120000      E     LCALL   _EEPROM_Write
00CC 900000      R     MOV     DPTR,#writeStatus
00CF EF                MOV     A,R7
00D0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 83
00D1         ?C0008:
                                           ; SOURCE LINE # 86
00D1 900000      R     MOV     DPTR,#RegPointer
00D4 7480              MOV     A,#080H
00D6 F0                MOVX    @DPTR,A
00D7 A3                INC     DPTR
00D8 E4                CLR     A
00D9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 87
00DA 900000      R     MOV     DPTR,#Index
00DD F0                MOVX    @DPTR,A
00DE A3                INC     DPTR
00DF F0                MOVX    @DPTR,A
00E0         ?C0009:
00E0 900000      R     MOV     DPTR,#Index
00E3 E0                MOVX    A,@DPTR
00E4 FE                MOV     R6,A
00E5 A3                INC     DPTR
00E6 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 7   

00E7 C3                CLR     C
00E8 9410              SUBB    A,#010H
00EA EE                MOV     A,R6
00EB 9400              SUBB    A,#00H
00ED 4003              JC      $ + 5H
00EF 020000      R     LJMP    ?C0010
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 89
00F2 900000      R     MOV     DPTR,#Index
00F5 E0                MOVX    A,@DPTR
00F6 A3                INC     DPTR
00F7 E0                MOVX    A,@DPTR
00F8 FF                MOV     R7,A
00F9 A3                INC     DPTR
00FA E0                MOVX    A,@DPTR
00FB FC                MOV     R4,A
00FC A3                INC     DPTR
00FD E0                MOVX    A,@DPTR
00FE 2F                ADD     A,R7
00FF F582              MOV     DPL,A
0101 EC                MOV     A,R4
0102 3E                ADDC    A,R6
0103 F583              MOV     DPH,A
0105 E0                MOVX    A,@DPTR
0106 FF                MOV     R7,A
0107 900000      R     MOV     DPTR,#Index
010A E0                MOVX    A,@DPTR
010B FC                MOV     R4,A
010C A3                INC     DPTR
010D E0                MOVX    A,@DPTR
010E 2400        R     ADD     A,#LOW TestData1
0110 F582              MOV     DPL,A
0112 7400        R     MOV     A,#HIGH TestData1
0114 3C                ADDC    A,R4
0115 F583              MOV     DPH,A
0117 E0                MOVX    A,@DPTR
0118 6F                XRL     A,R7
0119 601E              JZ      ?C0012
                                           ; SOURCE LINE # 90
                                           ; SOURCE LINE # 91
011B E4                CLR     A
011C FD                MOV     R5,A
011D 7F01              MOV     R7,#01H
011F 120000      E     LCALL   _CharLCD_1_Position
                                           ; SOURCE LINE # 92
0122 7BFF              MOV     R3,#0FFH
0124 7A00        R     MOV     R2,#HIGH ?SC_13
0126 7900        R     MOV     R1,#LOW ?SC_13
0128 120000      E     LCALL   _CharLCD_1_PrintString
                                           ; SOURCE LINE # 93
012B 900000      R     MOV     DPTR,#err+01H
012E E0                MOVX    A,@DPTR
012F 04                INC     A
0130 F0                MOVX    @DPTR,A
0131 7006              JNZ     ?C0021
0133 900000      R     MOV     DPTR,#err
0136 E0                MOVX    A,@DPTR
0137 04                INC     A
0138 F0                MOVX    @DPTR,A
0139         ?C0021:
                                           ; SOURCE LINE # 94
0139         ?C0012:
C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 8   

                                           ; SOURCE LINE # 95
0139 E4                CLR     A
013A FD                MOV     R5,A
013B FF                MOV     R7,A
013C 120000      E     LCALL   _CharLCD_1_Position
                                           ; SOURCE LINE # 96
013F 900000      R     MOV     DPTR,#Index
0142 E0                MOVX    A,@DPTR
0143 FE                MOV     R6,A
0144 A3                INC     DPTR
0145 E0                MOVX    A,@DPTR
0146 FF                MOV     R7,A
0147 A3                INC     DPTR
0148 E0                MOVX    A,@DPTR
0149 FC                MOV     R4,A
014A A3                INC     DPTR
014B E0                MOVX    A,@DPTR
014C 2F                ADD     A,R7
014D F582              MOV     DPL,A
014F EC                MOV     A,R4
0150 3E                ADDC    A,R6
0151 F583              MOV     DPH,A
0153 E0                MOVX    A,@DPTR
0154 FF                MOV     R7,A
0155 120000      E     LCALL   _CharLCD_1_PrintInt8
                                           ; SOURCE LINE # 97
0158 E4                CLR     A
0159 7FF4              MOV     R7,#0F4H
015B 7E01              MOV     R6,#01H
015D FD                MOV     R5,A
015E FC                MOV     R4,A
015F 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 98
0162 900000      R     MOV     DPTR,#Index+01H
0165 E0                MOVX    A,@DPTR
0166 04                INC     A
0167 F0                MOVX    @DPTR,A
0168 7006              JNZ     ?C0022
016A 900000      R     MOV     DPTR,#Index
016D E0                MOVX    A,@DPTR
016E 04                INC     A
016F F0                MOVX    @DPTR,A
0170         ?C0022:
0170 020000      R     LJMP    ?C0009
0173         ?C0010:
                                           ; SOURCE LINE # 100
0173 900000      R     MOV     DPTR,#eraseStatus
0176 E0                MOVX    A,@DPTR
0177 701F              JNZ     ?C0013
0179 A3                INC     DPTR
017A E0                MOVX    A,@DPTR
017B 701B              JNZ     ?C0013
017D 900000      R     MOV     DPTR,#err
0180 E0                MOVX    A,@DPTR
0181 FE                MOV     R6,A
0182 A3                INC     DPTR
0183 E0                MOVX    A,@DPTR
0184 4E                ORL     A,R6
0185 7011              JNZ     ?C0013
                                           ; SOURCE LINE # 101
                                           ; SOURCE LINE # 102
0187 FD                MOV     R5,A
C51 COMPILER V9.51   MAIN                                                                  02/27/2014 19:08:28 PAGE 9   

0188 7F01              MOV     R7,#01H
018A 120000      E     LCALL   _CharLCD_1_Position
                                           ; SOURCE LINE # 103
018D 7BFF              MOV     R3,#0FFH
018F 7A00        R     MOV     R2,#HIGH ?SC_26
0191 7900        R     MOV     R1,#LOW ?SC_26
0193 120000      E     LCALL   _CharLCD_1_PrintString
                                           ; SOURCE LINE # 104
0196 8010              SJMP    ?C0015
0198         ?C0013:
                                           ; SOURCE LINE # 106
                                           ; SOURCE LINE # 107
0198 E4                CLR     A
0199 FD                MOV     R5,A
019A 7F01              MOV     R7,#01H
019C 120000      E     LCALL   _CharLCD_1_Position
                                           ; SOURCE LINE # 108
019F 7BFF              MOV     R3,#0FFH
01A1 7A00        R     MOV     R2,#HIGH ?SC_45
01A3 7900        R     MOV     R1,#LOW ?SC_45
01A5 120000      E     LCALL   _CharLCD_1_PrintString
                                           ; SOURCE LINE # 109
                                           ; SOURCE LINE # 111
01A8         ?C0015:
                                           ; SOURCE LINE # 112
                                           ; SOURCE LINE # 113
01A8 80FE              SJMP    ?C0015
01AA 22                RET     
             ; FUNCTION main (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    427    ----
   CONSTANT SIZE    =     80    ----
   XDATA SIZE       =   ----      24
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
